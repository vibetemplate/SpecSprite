# VibeGen MCP-1: `éœ€æ±‚ç²¾çµ (SpecSprite)` å¼€å‘æ–‡æ¡£

## 1. ç®€ä»‹ä¸å®šä½

- **è§’è‰²**: `éœ€æ±‚ç²¾çµ` (SpecSprite)
- **åˆ«å**: ä¸Šä¸‹æ–‡å·¥ç¨‹å¸ˆ (Context Engineer), é¡¹ç›®æ„æƒ³è€…
- **æœåŠ¡åç§°**: `prd-generator`
- **æ¶æ„å®šä½**: VibeGen åŒç‹¬ç«‹ MCP æœåŠ¡æ¶æ„ä¸­çš„ MCP-1 æœåŠ¡
- **æ ¸å¿ƒä½¿å‘½**: ä½œä¸ºVibeGenç³»ç»Ÿçš„"æ™ºæ…§å‘å¯¼"ï¼Œ`éœ€æ±‚ç²¾çµ`çš„æ ¸å¿ƒä½¿å‘½æ˜¯**æ‰§è¡Œä¸Šä¸‹æ–‡å·¥ç¨‹**ã€‚å®ƒä¸ç›´æ¥ç¼–å†™é¡¹ç›®ä»£ç ï¼Œè€Œæ˜¯é€šè¿‡ä¸å¼€å‘è€…è¿›è¡Œé«˜è´¨é‡çš„ã€ç»“æ„åŒ–çš„å¯¹è¯ï¼Œå°†ä¸€ä¸ªæ¨¡ç³Šçš„åˆå§‹æƒ³æ³•ï¼Œç³»ç»Ÿæ€§åœ°è½¬åŒ–ä¸ºä¸€ä»½ç²¾ç¡®ã€å®Œæ•´ã€å¯ä¾›ä¸‹æ¸¸æ‰§è¡Œçš„é¡¹ç›®è“å›¾ (`prd.json`)ã€‚

### 1.1 æ¶æ„å†³ç­–èƒŒæ™¯

åŸºäº [VibeGenæ¶æ„å†³ç­–è®°å½• (ADR-001)](/docs/vibegen_architecture_decision.md)ï¼ŒSpecSprite é‡‡ç”¨**åŒç‹¬ç«‹MCPæœåŠ¡**æ¶æ„ä¸­çš„å…³é”®è®¾è®¡åŸåˆ™ï¼š

- **é›¶ç”¨æˆ·æˆæœ¬**: å®Œå…¨ä¾èµ– Cursor IDE çš„ LLM èƒ½åŠ›ï¼Œç”¨æˆ·æ— éœ€é…ç½®ä»»ä½• API Key
- **æ ‡å‡† MCP åè®®**: ä½¿ç”¨æˆç†Ÿç¨³å®šçš„ MCP åŠŸèƒ½ï¼Œç¡®ä¿ä»Šå¤©å°±èƒ½å¼€å§‹å¼€å‘
- **æ™ºèƒ½ä½†ä¸“æ³¨**: åœ¨ PRD ç”Ÿæˆé¢†åŸŸåšåˆ°æè‡´æ™ºèƒ½ï¼Œä½†ä¸¥æ ¼é¿å…è¶Šç•Œåˆ°ä»£ç ç”Ÿæˆ

## 2. æ¶æ„ä¸è®¾è®¡åŸåˆ™

### 2.1 è®¾è®¡å“²å­¦
- **ä¸Šä¸‹æ–‡å·¥ç¨‹ (Context Engineering)**: `éœ€æ±‚ç²¾çµ`æ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹ç†å¿µçš„ç›´æ¥ä½“ç°ã€‚å®ƒé€šè¿‡åŠ¨æ€åŠ è½½ä¸“å®¶çŸ¥è¯†ã€è°ƒç”¨å¤–éƒ¨å·¥å…·ã€å¼•å¯¼å¼å¯¹è¯ç­‰æ–¹å¼ï¼Œä¸ºåç»­çš„ä»£ç ç”Ÿæˆä»»åŠ¡æ„å»ºä¸€ä¸ªå®Œç¾çš„ã€æ— æ­§ä¹‰çš„ä¸Šä¸‹æ–‡ã€‚
- **å…³æ³¨ç‚¹åˆ†ç¦»**: `éœ€æ±‚ç²¾çµ`å°†å……æ»¡ä¸ç¡®å®šæ€§çš„"éœ€æ±‚æ¢ç´¢"é˜¶æ®µä¸é«˜åº¦ç¡®å®šæ€§çš„"ä»£ç æ„å»º"é˜¶æ®µå½»åº•åˆ†ç¦»ï¼Œç¡®ä¿äº†å„è‡ªé¢†åŸŸçš„ä¸“ä¸šæ€§å’Œæ•´ä¸ªæµç¨‹çš„é«˜æ•ˆç‡ã€‚
- **å€ŸåŠ›ä¸è´¹åŠ›**: é€šè¿‡ MCP åè®®æ™ºèƒ½å€Ÿç”¨ Cursor IDE çš„ LLM èƒ½åŠ›ï¼Œå®ç°é›¶ç”¨æˆ·æˆæœ¬çš„æ™ºèƒ½å¯¹è¯ã€‚

### 2.2 æ ¸å¿ƒç»„ä»¶
`éœ€æ±‚ç²¾çµ`æœåŠ¡å†…éƒ¨ç”±ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶æ„æˆï¼š
- **æ ¸å¿ƒé€»è¾‘ (SpecSprite Core)**: è´Ÿè´£å¤„ç†å¯¹è¯æµç¨‹ã€ç®¡ç†ä¸Šä¸‹æ–‡ã€å†³ç­–ä½•æ—¶åŠ è½½ä¸“å®¶æˆ–ä½¿ç”¨å·¥å…·ã€‚
- **LLM è°ƒç”¨ç®¡ç†å™¨**: å°è£…å¯¹ Cursor IDE çš„ LLM è¡¥å…¨è¯·æ±‚ï¼Œå®ç°æ™ºèƒ½çš„ä¸Šä¸‹æ–‡æ„å»ºå’Œå“åº”å¤„ç†ã€‚
- **ä¼šè¯çŠ¶æ€ç®¡ç†å™¨**: å€Ÿé‰´ vibecli çš„ `mcp-context-manager.ts` è®¾è®¡ï¼Œç»´æŠ¤å¤šè½®å¯¹è¯çŠ¶æ€å’Œç”¨æˆ·åå¥½ã€‚
- **å†…éƒ¨æç¤ºè¯åº“ (Prompt Library)**: å­˜å‚¨ä¸€ç³»åˆ—"ä¸“å®¶è§’è‰²å¡" (`prompt_template_*.md`)ï¼Œæ¯ä¸ªè§’è‰²å¡éƒ½å®šä¹‰äº†ä¸€ä¸ªç‰¹å®šé¡¹ç›®ç±»å‹ï¼ˆå¦‚åšå®¢ã€SaaSï¼‰çš„å¯¹è¯æµç¨‹å’ŒçŸ¥è¯†ä½“ç³»ã€‚
- **æ„å›¾åˆ†ç±»å™¨ (Intent Classifier)**: åœ¨å¯¹è¯å¼€å§‹æ—¶ï¼Œå¯¹ç”¨æˆ·çš„åˆå§‹éœ€æ±‚è¿›è¡Œå¿«é€Ÿåˆ†ç±»ï¼Œä»¥ä¾¿åŠ è½½æœ€åˆé€‚çš„ä¸“å®¶è§’è‰²å¡ã€‚

### 2.3 é¡¹ç›®ç»“æ„è®¾è®¡

```
SpecSprite/
â”œâ”€â”€ package.json                    # ä¾èµ–ç®¡ç†ï¼Œä½¿ç”¨ @modelcontextprotocol/sdk
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                   # MCP æœåŠ¡å™¨å…¥å£ç‚¹
â”‚   â”œâ”€â”€ server.ts                  # ä¸»æœåŠ¡å™¨é€»è¾‘ï¼Œæ³¨å†Œå·¥å…·
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ spec-sprite-service.ts # æ ¸å¿ƒæœåŠ¡é€»è¾‘ï¼ˆå€Ÿé‰´ vibecli æ¨¡å¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ conversation-manager.ts # ä¼šè¯ç®¡ç†ï¼ˆåŸºäº vibecli/mcp-context-manager.tsï¼‰
â”‚   â”‚   â”œâ”€â”€ llm-client.ts          # Cursor LLM è°ƒç”¨å°è£…
â”‚   â”‚   â”œâ”€â”€ intent-classifier.ts   # æ„å›¾åˆ†æå’Œä¸“å®¶é€‰æ‹©
â”‚   â”‚   â””â”€â”€ types.ts              # ç±»å‹å®šä¹‰ï¼ˆå¤ç”¨ vibecli æ ¸å¿ƒç±»å‹ï¼‰
â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â”œâ”€â”€ system/
â”‚   â”‚   â”‚   â”œâ”€â”€ meta-prompt.md    # SpecSprite å…ƒæç¤ºè¯
â”‚   â”‚   â”‚   â””â”€â”€ intent-classifier.md # æ„å›¾åˆ†ç±»æç¤ºè¯
â”‚   â”‚   â””â”€â”€ experts/              # ä¸“å®¶è§’è‰²å¡ï¼ˆä» vibecli ç§»æ¤å‡çº§ï¼‰
â”‚   â”‚       â”œâ”€â”€ saas-expert.md
â”‚   â”‚       â”œâ”€â”€ portfolio-expert.md
â”‚   â”‚       â”œâ”€â”€ ecommerce-expert.md
â”‚   â”‚       â”œâ”€â”€ blog-expert.md
â”‚   â”‚       â””â”€â”€ generic-expert.md
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ prd-schema.json       # PRD è¾“å‡ºæ ¼å¼éªŒè¯
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ prd-builder.ts        # PRD æ„å»ºå’ŒéªŒè¯
â”‚   â”‚   â””â”€â”€ prompt-loader.ts      # åŠ¨æ€æç¤ºè¯åŠ è½½
â”‚   â””â”€â”€ __tests__/                # æµ‹è¯•ç”¨ä¾‹ï¼ˆå€Ÿé‰´ vibecli æµ‹è¯•æ¨¡å¼ï¼‰
â”‚       â”œâ”€â”€ core/
â”‚       â”œâ”€â”€ integration/
â”‚       â””â”€â”€ fixtures/
â”œâ”€â”€ README.md
â””â”€â”€ tsconfig.json
```

## 3. å†…éƒ¨å·¥ä½œæµç¨‹

`éœ€æ±‚ç²¾çµ`é€šè¿‡"å†…åŒ–æ„å›¾åˆ†ç±»"å’Œ"åŠ¨æ€åŠ è½½ä¸“å®¶è§’è‰²å¡"çš„æ¨¡å¼æ¥å®Œæˆå¤æ‚çš„å¯¹è¯ä»»åŠ¡ã€‚å…³é”®çš„æŠ€æœ¯åˆ›æ–°åœ¨äº**é€šè¿‡ MCP åè®®å‘ Cursor IDE è¯·æ±‚ LLM è¡¥å…¨**ï¼Œå®ç°é›¶æˆæœ¬çš„æ™ºèƒ½å¯¹è¯ã€‚

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant CursorIDE as "Cursor IDE (Host)"
    box "éœ€æ±‚ç²¾çµ (MCP-1) æœåŠ¡å†…éƒ¨"
        participant éœ€æ±‚ç²¾çµ as "æ ¸å¿ƒé€»è¾‘ (SpecSprite)"
        participant PromptLibrary as "å†…éƒ¨æç¤ºè¯åº“"
    end

    %% === æ­¥éª¤ 1: ç”¨æˆ·å‘èµ·è¯·æ±‚ ===
    User->>CursorIDE: 1. "@vibeGen æˆ‘æƒ³åšä¸€ä¸ªä½œå“é›†ç½‘ç«™..."

    CursorIDE->>éœ€æ±‚ç²¾çµ: 2. è°ƒç”¨å·¥å…·: `generate_prd(...)`
    
    %% === æ­¥éª¤ 2: éœ€æ±‚ç²¾çµå†…éƒ¨è¿›è¡Œæ„å›¾åˆ†ç±» ===
    éœ€æ±‚ç²¾çµ->>CursorIDE: 3. **è¯·æ±‚LLMè¡¥å…¨ (è¿›è¡Œæ„å›¾åˆ†ç±»)**<br/>ä½¿ç”¨`IntentClassifier`æç¤ºè¯ + ç”¨æˆ·è¾“å…¥<br/>âš¡ å…³é”®åˆ›æ–°ï¼šé›¶æˆæœ¬å€Ÿç”¨Cursorçš„LLM
    CursorIDE-->>éœ€æ±‚ç²¾çµ: 4. è¿”å›åˆ†ç±»ç»“æœ: `{"project_type": "portfolio"}`

    %% === æ­¥éª¤ 3: éœ€æ±‚ç²¾çµåŠ è½½ä¸“å®¶è§’è‰²å¡ ===
    éœ€æ±‚ç²¾çµ->>PromptLibrary: 5. æ ¹æ® "portfolio" æ ‡ç­¾, è¯·æ±‚<br/>`prompt_template_portfolio.md`
    PromptLibrary-->>éœ€æ±‚ç²¾çµ: 6. è¿”å› "ä½œå“é›†ä¸“å®¶" æç¤ºè¯å†…å®¹

    éœ€æ±‚ç²¾çµ->>éœ€æ±‚ç²¾çµ: 7. **æ„å»ºå®Œæ•´å¯¹è¯ä¸Šä¸‹æ–‡**<br/>(å…ƒæç¤ºè¯ + ä¸“å®¶è§’è‰²å¡ + å¯¹è¯å†å²)
    Note over éœ€æ±‚ç²¾çµ: è¿™æ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹çš„å…³é”®ä¸€æ­¥ï¼š<br>åŠ¨æ€åœ°å°†å¤šä¸ªä¿¡æ¯æº<br>ç»„åˆæˆä¸€ä¸ªæœ‰æ•ˆçš„LLM Promptã€‚

    %% === æ­¥éª¤ 4: éœ€æ±‚ç²¾çµä¸ç”¨æˆ·è¿›è¡Œæ·±åº¦äº¤äº’ (å·¥å…·ä½¿ç”¨ç¤ºä¾‹) ===
    éœ€æ±‚ç²¾çµ->>CursorIDE: 8. **è¯·æ±‚LLMè¡¥å…¨ (å¼€å§‹å¼•å¯¼å¼å¯¹è¯)**<br/>"æ‚¨å¥½ï¼å…³äºæŠ€æœ¯é€‰å‹, <br/>æˆ‘æ¨èAstroï¼Œæ‚¨è§‰å¾—å‘¢ï¼Ÿ"<br/>ğŸ’¡ ä½¿ç”¨ ä¸“å®¶è§’è‰²å¡ + å…ƒæç¤ºè¯ æ„å»ºä¸Šä¸‹æ–‡
    
    User->>CursorIDE: 9. "æˆ‘å¬è¯´è¿‡Astroå’ŒNext.jsï¼Œ<br/>ä¸çŸ¥é“å“ªä¸ªæ›´é€‚åˆå±•ç¤ºå¤§é‡å›¾ç‰‡ã€‚"
    
    CursorIDE->>éœ€æ±‚ç²¾çµ: 10. (è½¬è¾¾ç”¨æˆ·ç–‘æƒ‘)

    éœ€æ±‚ç²¾çµ->>CursorIDE: 11. **è¯·æ±‚LLMè¡¥å…¨ (å†³ç­–æ˜¯å¦ä½¿ç”¨å·¥å…·)**
    CursorIDE-->>éœ€æ±‚ç²¾çµ: 12. (LLMè¿”å›å†³ç­–: ä½¿ç”¨ `web_search` è°ƒç ”)

    éœ€æ±‚ç²¾çµ->>CursorIDE: 13. **è§£é‡Šå¹¶è¯·æ±‚æˆæƒ**<br/>"ä¸ºäº†ç»™æ‚¨æœ€ä¸“ä¸šçš„å»ºè®®, æˆ‘éœ€è¦è°ƒç ”ä¸€ä¸‹..."
    
    Note over éœ€æ±‚ç²¾çµ, User: ... å¯¹è¯ç»§ç»­ï¼Œç›´è‡³PRDæ‰€æœ‰è¦ç´ è¡¥å…¨ ...

    %% === æ­¥éª¤ 5: éœ€æ±‚ç²¾çµç”ŸæˆPRDå¹¶ç§»äº¤ ===
    éœ€æ±‚ç²¾çµ->>CursorIDE: 22. è¿”å›æœ€ç»ˆçš„ `prd.json`
```

## 4. ç³»ç»Ÿæç¤ºè¯ (System Prompts)

### 4.1. `IntentClassifier` (å†…éƒ¨æ„å›¾åˆ†ç±»å™¨)
è¿™æ˜¯`éœ€æ±‚ç²¾çµ`æœåŠ¡å†…éƒ¨å·¥ä½œæµçš„ç¬¬ä¸€æ­¥ï¼Œç”¨äºå¯¹ç”¨æˆ·çš„åˆå§‹éœ€æ±‚è¿›è¡Œå¿«é€Ÿåˆ†ç±»ã€‚

```markdown
# **ç³»ç»Ÿæç¤ºè¯ï¼švibeGen æ„å›¾åˆ†ç±»å™¨**

## è§’è‰² (Persona)
ä½ æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ–‡æœ¬åˆ†ç±»å¼•æ“ã€‚ä½ çš„ä»»åŠ¡æ˜¯è¯»å–ç”¨æˆ·çš„åˆå§‹è¯·æ±‚ï¼Œå¹¶å°†å…¶ç²¾å‡†åœ°æ˜ å°„åˆ°ä¸€ä¸ªé¢„å®šä¹‰çš„é¡¹ç›®ç±»å‹ã€‚

## æ ¸å¿ƒæŒ‡ä»¤
1.  **å”¯ä¸€ä»»åŠ¡**: åˆ†æè¾“å…¥æ–‡æœ¬ï¼Œè¾“å‡ºä¸€ä¸ªæœ€åŒ¹é…çš„åˆ†ç±»æ ‡ç­¾ã€‚
2.  **ä¸¥æ ¼åŒ¹é…**: ä½ çš„è¾“å‡º**å¿…é¡»**æ˜¯ä»¥ä¸‹åˆ—è¡¨ä¸­çš„ä¸€ä¸ªæ ‡ç­¾ï¼š`blog`, `ecommerce`, `saas`, `portfolio`, `landing_page`, `generic`ã€‚
3.  **æ ¼å¼è¦æ±‚**: ä½ çš„æœ€ç»ˆè¾“å‡ºå¿…é¡»æ˜¯ä¸€ä¸ªåªåŒ…å«åˆ†ç±»æ ‡ç­¾çš„JSONå¯¹è±¡ï¼Œæ ¼å¼ä¸ºï¼š`{"project_type": "æ ‡ç­¾å"}`ã€‚
4.  **ç¦æ­¢äº¤äº’**: ç»ä¸ä¸ç”¨æˆ·è¿›è¡Œä»»ä½•å½¢å¼çš„å¯¹è¯ã€‚å¦‚æœæ— æ³•ç¡®å®šåˆ†ç±»ï¼Œè¿”å› `{"project_type": "generic"}`ã€‚
```

### 4.2. `éœ€æ±‚ç²¾çµ` (SpecSprite) å…ƒæç¤ºè¯
è¿™ä¸ª"å…ƒæç¤ºè¯"å®šä¹‰äº†`éœ€æ±‚ç²¾çµ`çš„åŸºç¡€è¡Œä¸ºå‡†åˆ™ã€‚å®ƒä¼šä¸å…·ä½“çš„"ä¸“å®¶è§’è‰²å¡"ç»„åˆï¼Œå½¢æˆå®Œæ•´çš„å¯¹è¯ä¸Šä¸‹æ–‡ã€‚

```markdown
# **ç³»ç»Ÿå…ƒæç¤ºè¯ï¼švibeGen éœ€æ±‚ç²¾çµ (SpecSprite) è¡Œä¸ºå‡†åˆ™**

## è§’è‰² (Persona)
ä½ æ˜¯ä¸€ä¸ªAIäº§å“ä¸“å®¶ï¼Œæ˜¯ `vibeGen` å›¢é˜Ÿçš„**æ™ºæ…§å‘å¯¼ `éœ€æ±‚ç²¾çµ` (SpecSprite)**ã€‚ä½ çš„åå­—å’Œä¸“é•¿ç”±å½“å‰åŠ è½½çš„"ä¸“å®¶è§’è‰²å¡"å†³å®šã€‚ä½ ä¸ä»…æ“…é•¿å¯¹è¯ï¼Œè¿˜ç²¾é€šä½¿ç”¨ä¸€ç³»åˆ—å·¥å…·æ¥è¾…åŠ©ä½ å®Œæˆä»»åŠ¡ã€‚

## æ ¸å¿ƒæŒ‡ä»¤
1.  **è§’è‰²æ‰®æ¼”**: ä½ å¿…é¡»ä¸¥æ ¼éµå¾ªå½“å‰åŠ è½½çš„"ä¸“å®¶è§’è‰²å¡"ä¸­çš„æ‰€æœ‰è®¾å®šå’Œå¯¹è¯æµç¨‹ã€‚
2.  **ç›®æ ‡é©±åŠ¨**: ä½ çš„å”¯ä¸€ç›®æ ‡æ˜¯åŸºäº"ä¸“å®¶è§’è‰²å¡"çš„æŒ‡å¼•ï¼Œé€šè¿‡å¯¹è¯å’Œä½¿ç”¨å·¥å…·ï¼Œç”Ÿæˆä¸€ä»½å®Œæ•´ã€å‡†ç¡®çš„ `prd.json`ã€‚
3.  **å·¥å…·ä¼˜å…ˆäºçŒœæµ‹**: å½“é‡åˆ°æœªçŸ¥æˆ–éœ€è¦å¤–éƒ¨ä¿¡æ¯æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨å·¥å…·è§£å†³ï¼Œè€Œä¸æ˜¯è®©ç”¨æˆ·å•æ–¹é¢å†³ç­–ã€‚
4.  **å…ˆè§£é‡Šï¼Œå†æ‰§è¡Œ**: åœ¨è°ƒç”¨ä»»ä½•å·¥å…·å‰ï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·æ¸…æ™°åœ°è§£é‡Šä½ **ä¸ºä»€ä¹ˆ**éœ€è¦ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œä»¥åŠä½ **æœŸæœ›**é€šè¿‡å®ƒè·å¾—ä»€ä¹ˆä¿¡æ¯ã€‚

## å¯ç”¨å·¥å…·é›† (Available Toolset)
ä½ è¢«æˆæƒåœ¨å¿…è¦æ—¶è°ƒç”¨ç”±å®¿ä¸»IDEï¼ˆå¦‚Cursorï¼‰æä¾›çš„å·¥å…·é›†æ¥ä¸°å¯Œå’Œå®Œå–„PRDçš„åˆ›å»ºè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº `web_search`, `codebase_search`, `read_file`, `update_memory`, å’Œ `run_terminal_cmd`ã€‚
```

### 4.3. ä¸“å®¶è§’è‰²å¡ç¤ºä¾‹ (`prompt_template_saas.md`)
è¿™æ˜¯å­˜æ”¾äºå†…éƒ¨æç¤ºè¯åº“ä¸­çš„ä¸€ä¸ªå…·ä½“è§’è‰²å¡ã€‚

```markdown
# **ä¸“å®¶è§’è‰²å¡ï¼šSaaSäº§å“é¡¾é—®**

## ä¸“é•¿ (Expertise)
ä¸“æ³¨äºå¤šç§Ÿæˆ·æ¶æ„ã€è®¢é˜…åˆ¶è®¡è´¹å’Œç”¨æˆ·æƒé™ç®¡ç†çš„SaaSäº§å“ä¸“å®¶ã€‚

## å¯¹è¯å·¥ä½œæµ (Conversation Workflow)
1.  **å¼€åœº**: é—®å€™å¹¶è‡ªæˆ‘ä»‹ç»ä¸º"SaaSäº§å“é¡¾é—®"ã€‚æå‡ºç¬¬ä¸€ä¸ªå¼•å¯¼æ€§é—®é¢˜ï¼š"æ‚¨çš„SaaSäº§å“ä¸»è¦è§£å†³ä»€ä¹ˆæ ¸å¿ƒé—®é¢˜ï¼Ÿ"
2.  **æ ¸å¿ƒåŠŸèƒ½**:
    *   **è®¡è´¹æ¨¡å¼**: è¯¢é—®è®¢é˜…æ–¹æ¡ˆã€‚ [æŒ‰æœˆ/å¹´ä»˜è´¹, æŒ‰ä½¿ç”¨é‡ä»˜è´¹, æ··åˆæ¨¡å¼]
    *   **æ”¯ä»˜é›†æˆ**: è¯¢é—®ç”¨äºè®¢é˜…åˆ¶æ”¶æ¬¾çš„æ”¯ä»˜ç½‘å…³ã€‚ [Stripe Billing, Paddle, Lemon Squeezy]
    *   **ç”¨æˆ·ä½“ç³»**: è¯¢é—®å¤šç§Ÿæˆ·å’Œæƒé™ç®¡ç†ã€‚ [ä¸ªäººè´¦æˆ·, æ”¯æŒå›¢é˜Ÿå’Œè§’è‰²çš„ç»„ç»‡è´¦æˆ·]
3.  **æŠ€æœ¯é€‰å‹**:
    *   **æ•°æ®åº“**: "è€ƒè™‘åˆ°å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»ï¼Œæ‚¨å€¾å‘äºä½¿ç”¨è¡Œçº§å®‰å…¨(RLS)çš„PostgreSQL (å¦‚Supabase)ï¼Œè¿˜æ˜¯æ¯ä¸ªç§Ÿæˆ·ä¸€ä¸ªç‹¬ç«‹æ•°æ®åº“çš„æ¨¡å¼ï¼Ÿ"
    *   **åå°ä»»åŠ¡**: "å¯¹äºé‚®ä»¶é€šçŸ¥ã€æ•°æ®å¤„ç†ç­‰å¼‚æ­¥ä»»åŠ¡ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªåå°ä»»åŠ¡é˜Ÿåˆ—å—ï¼Ÿ[æ˜¯, å¦]"
4.  **æ”¶å°¾**: æ€»ç»“SaaSçš„æ ¸å¿ƒæ¶æ„å’ŒåŠŸèƒ½ï¼Œç”ŸæˆåŒ…å« `billingModel`, `authStructure`, `tenantIsolation` ç­‰å­—æ®µçš„ `prd.json`ã€‚
```

## 5. æ¥å£ä¸æ•°æ®ç»“æ„

### 5.1 MCP å·¥å…·æ¥å£

#### ä¸»å·¥å…·ï¼š`generate_prd`
```typescript
interface GeneratePRDInput {
  user_input: string;           // ç”¨æˆ·è¾“å…¥çš„éœ€æ±‚æè¿°
  session_id?: string;          // å¯é€‰çš„ä¼šè¯IDï¼Œç”¨äºå¤šè½®å¯¹è¯
  continue_conversation?: boolean; // æ˜¯å¦ç»§ç»­ç°æœ‰å¯¹è¯
}

interface GeneratePRDOutput {
  type: 'conversation' | 'prd';
  session_id: string;
  content: {
    // å¦‚æœæ˜¯å¯¹è¯çŠ¶æ€
    message?: string;           // å›å¤ç”¨æˆ·çš„æ¶ˆæ¯
    questions?: string[];       // æ¾„æ¸…é—®é¢˜
    // å¦‚æœæ˜¯å®ŒæˆçŠ¶æ€
    prd?: PRDSchema;           // å®Œæ•´çš„PRDå¯¹è±¡
  }
}
```

#### è¾…åŠ©å·¥å…·ï¼š`continue_conversation`
ç”¨äºæ”¯æŒå¤æ‚çš„å¤šè½®å¯¹è¯åœºæ™¯ã€‚

### 5.2 æ ¸å¿ƒæ•°æ®ç»“æ„

#### PRD Schema (åŸºäº vibecli æ‰©å±•)
```typescript
interface PRDSchema {
  metadata: {
    name: string;
    version: string;
    generated_at: string;
    confidence_score: number;
  };
  project: {
    type: 'blog' | 'ecommerce' | 'saas' | 'portfolio' | 'landing_page';
    description: string;
    target_audience: string;
    key_features: string[];
  };
  tech_stack: {
    framework: string;
    database?: string;
    ui_library: string;
    deployment_platform?: string;
  };
  features: {
    auth: boolean;
    payment: boolean;
    admin: boolean;
    search: boolean;
    // ... å…¶ä»–åŠŸèƒ½æ ‡å¿—
  };
  specifications: {
    // è¯¦ç»†çš„åŠŸèƒ½è§„æ ¼
    [feature: string]: any;
  };
  next_steps: string[];
}
```

#### ä¼šè¯çŠ¶æ€ (å¤ç”¨ vibecli æ¨¡å¼)
```typescript
interface SpecSpriteSession {
  id: string;
  started_at: Date;
  last_activity: Date;
  conversation_history: ConversationTurn[];
  accumulated_context: {
    project_type?: string;
    detected_features: string[];
    user_preferences: Record<string, any>;
    clarifications_resolved: string[];
  };
  current_expert?: string; // å½“å‰åŠ è½½çš„ä¸“å®¶è§’è‰²å¡
  status: 'active' | 'completed' | 'abandoned';
}
```

## 6. å…³é”®æŠ€æœ¯å®ç°

### 6.1 MCP LLM è°ƒç”¨çš„æœ€ä½³å®è·µ

åŸºäºæ¶æ„å†³ç­–ï¼ŒSpecSprite çš„æ ¸å¿ƒæŠ€æœ¯ä¼˜åŠ¿åœ¨äº**é€šè¿‡ MCP åè®®æ™ºèƒ½å€Ÿç”¨ Cursor IDE çš„ LLM èƒ½åŠ›**ï¼š

```typescript
// æ ¸å¿ƒ LLM è°ƒç”¨å°è£…
class CursorLLMClient {
  async requestCompletion(prompt: string, context?: any): Promise<string> {
    // é€šè¿‡ MCP åè®®å‘ Cursor è¯·æ±‚ LLM è¡¥å…¨
    // è¿™æ˜¯é›¶æˆæœ¬æ¶æ„çš„æ ¸å¿ƒå®ç°
    return await this.mcpServer.requestCompletion({
      prompt,
      context,
      // è‡ªåŠ¨ä½¿ç”¨ç”¨æˆ·åœ¨ Cursor ä¸­é…ç½®çš„æ¨¡å‹
    });
  }
  
  async classifyIntent(userInput: string): Promise<ProjectType> {
    const prompt = this.buildIntentClassificationPrompt(userInput);
    const response = await this.requestCompletion(prompt);
    return this.parseIntentResponse(response);
  }
}
```

### 6.2 æ™ºèƒ½ä¸Šä¸‹æ–‡æ„å»º

å€Ÿé‰´ vibecli çš„æˆåŠŸæ¨¡å¼ï¼ŒåŠ¨æ€æ„å»ºé«˜è´¨é‡çš„ LLM ä¸Šä¸‹æ–‡ï¼š

```typescript
class ContextBuilder {
  buildConversationContext(
    session: SpecSpriteSession,
    expertCard: string,
    userInput: string
  ): string {
    return [
      this.metaPrompt,           // SpecSprite å…ƒæç¤ºè¯
      expertCard,                // åŠ¨æ€åŠ è½½çš„ä¸“å®¶è§’è‰²å¡
      this.formatConversationHistory(session.conversation_history),
      `å½“å‰ç”¨æˆ·è¾“å…¥: ${userInput}`,
    ].join('\n\n');
  }
}
```

### 6.3 å¤šè½®å¯¹è¯çŠ¶æ€ç®¡ç†

åŸºäº `vibecli/src/mcp/mcp-context-manager.ts` çš„è®¾è®¡æ¨¡å¼ï¼š

```typescript
class ConversationManager {
  private sessions = new Map<string, SpecSpriteSession>();
  
  async processUserInput(
    userInput: string, 
    sessionId?: string
  ): Promise<ConversationResponse> {
    const session = this.getOrCreateSession(sessionId);
    
    // 1. è®°å½•ç”¨æˆ·è¾“å…¥
    this.recordInput(session, userInput);
    
    // 2. åˆ†ææ˜¯å¦éœ€è¦æ¾„æ¸… vs å¯ä»¥ç”Ÿæˆ PRD
    const analysis = await this.analyzeReadiness(session);
    
    if (analysis.needsClarification) {
      return this.generateClarificationQuestions(session, analysis);
    } else {
      return this.generatePRD(session);
    }
  }
}
```

## 7. æ‰©å±•æ€§ä¸ç»´æŠ¤æ€§

- **æ”¯æŒæ–°é¡¹ç›®ç±»å‹**: åªéœ€åœ¨æç¤ºè¯åº“ä¸­å¢åŠ æ–°çš„ä¸“å®¶è§’è‰²å¡ï¼ˆå¦‚ `prompt_template_game.md`ï¼‰
- **æ”¯æŒæ–°å·¥å…·**: å¯ä»¥è½»æ¾è®© SpecSprite å­¦ä¼šä½¿ç”¨ Cursor IDE æä¾›çš„æ›´å¤šå·¥å…·
- **ä»£ç å¤ç”¨**: æœ€å¤§åŒ–å¤ç”¨ vibecli ä¸­å·²éªŒè¯çš„æ ¸å¿ƒé€»è¾‘å’Œç±»å‹å®šä¹‰
- **ç‹¬ç«‹éƒ¨ç½²**: å®Œå…¨ç‹¬ç«‹çš„ MCP æœåŠ¡ï¼Œä¸ä¸ vibecli äº§ç”Ÿè¿è¡Œæ—¶ä¾èµ–

## 8. å¼€å‘æ–¹æ³•è®ºä¸æœ€ä½³å®è·µ (åŸºäº vibecli æˆåŠŸç»éªŒ)

ä¸ºç¡®ä¿`éœ€æ±‚ç²¾çµ`çš„å¥å£®æ€§ã€å¯ç»´æŠ¤æ€§å’Œæ™ºèƒ½æ°´å¹³ï¼Œå¼€å‘è¿‡ç¨‹æ·±åº¦å€Ÿé‰´`vibecli`é¡¹ç›®çš„æˆåŠŸå·¥ç¨‹å®è·µã€‚

### 8.1 æ¶æ„è®¾è®¡: æœåŠ¡åŒ–ä¸æ¨¡å—åŒ–

- **æœåŠ¡åŒ–å°è£…**: å°†æ‰€æœ‰æ ¸å¿ƒé€»è¾‘å°è£…åœ¨ç‹¬ç«‹çš„`SpecSpriteService`ä¸­ï¼ŒMCP æœåŠ¡å™¨å…¥å£ä¿æŒè½»é‡ï¼Œä»…è´Ÿè´£å·¥å…·æ³¨å†Œå’Œè°ƒç”¨è½¬å‘
- **æ¨¡å—åŒ–è®¾è®¡**: å€Ÿé‰´ vibecli çš„æ¨¡å—åŒ–æ¶æ„ï¼Œæ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ä¸”å¯ç‹¬ç«‹æµ‹è¯•
- **é”™è¯¯å¤„ç†**: å®ç°æ ‡å‡†åŒ–çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§

### 8.2 æ ¸å¿ƒèƒ½åŠ›å®ç°: åŸºäº vibecli ç»éªŒ

`éœ€æ±‚ç²¾çµ`çš„æ™ºèƒ½åŸºäºå¯¹ä¸Šä¸‹æ–‡çš„æ·±åº¦ç®¡ç†ï¼Œç›´æ¥å¤ç”¨`vibecli/src/mcp/mcp-context-manager.ts`çš„è®¾è®¡ç²¾é«“ï¼š

- **ä¼šè¯çŠ¶æ€ç®¡ç†**: åŸºäº `MCPSessionState` æ¨¡å¼ï¼Œç»´æŠ¤å®Œæ•´çš„å¯¹è¯å†å²å’Œç”¨æˆ·åå¥½
- **ä¸Šä¸‹æ–‡åˆ†æå¼•æ“**: å¤ç”¨ vibecli çš„æ„å›¾åˆ†æèƒ½åŠ›ï¼Œæå–é¡¹ç›®ç±»å‹ã€åŠŸèƒ½éœ€æ±‚ã€æŠ€æœ¯åå¥½
- **æ™ºèƒ½å›é€€æœºåˆ¶**: ç§»æ¤ vibecli çš„ `IntelligentFallbackHandler` æ¨¡å¼ï¼š
    - **æ™ºèƒ½æ¾„æ¸…**: ç”Ÿæˆæœ‰é’ˆå¯¹æ€§çš„æ¾„æ¸…é—®é¢˜
    - **æ–¹æ¡ˆå»ºè®®**: åŸºäºç”¨æˆ·è¾“å…¥æä¾›ä¸“ä¸šå»ºè®®
    - **æ¸è¿›å¼å¼•å¯¼**: å°†å¤æ‚éœ€æ±‚åˆ†è§£ä¸ºå¯ç®¡ç†çš„å†³ç­–ç‚¹

### 8.3 ä»£ç å¤ç”¨ç­–ç•¥

- **ç±»å‹ç³»ç»Ÿ**: ç›´æ¥å¤ç”¨ `vibecli/src/core/types.ts` ä¸­çš„æ ¸å¿ƒç±»å‹å®šä¹‰
- **æç¤ºè¯ç³»ç»Ÿ**: ç§»æ¤å¹¶å‡çº§ `vibecli/src/prompts/project-types/` ä¸­çš„ä¸“å®¶è§’è‰²å¡
- **å·¥å…·æ¨¡å¼**: å€Ÿé‰´ vibecli MCP æœåŠ¡å™¨çš„å·¥å…·æ³¨å†Œå’Œå¤„ç†æ¨¡å¼
- **æµ‹è¯•æ¡†æ¶**: å¤ç”¨ vibecli çš„æµ‹è¯•ç»“æ„å’Œ mock ç­–ç•¥

### 8.4 å¼€å‘ä¼˜å…ˆçº§

**Phase 1: åŸºç¡€æ¶æ„** (å€Ÿé‰´ vibecli æ ¸å¿ƒ)
- MCP æœåŠ¡å™¨åŸºç¡€è®¾æ–½
- æ ¸å¿ƒç±»å‹å®šä¹‰å’Œæ¥å£
- åŸºç¡€çš„ LLM è°ƒç”¨å°è£…

**Phase 2: æ™ºèƒ½å¯¹è¯** (ç§»æ¤ vibecli æ™ºèƒ½)
- æ„å›¾åˆ†ç±»å’Œä¸“å®¶é€‰æ‹©
- å¤šè½®å¯¹è¯çŠ¶æ€ç®¡ç†
- åŠ¨æ€ä¸Šä¸‹æ–‡æ„å»º

**Phase 3: ä¸“å®¶ç³»ç»Ÿ** (å‡çº§ vibecli æç¤ºè¯)
- ä¸“å®¶è§’è‰²å¡ç³»ç»Ÿ
- æ™ºèƒ½æ¾„æ¸…å’Œå»ºè®®æœºåˆ¶
- PRD ç”Ÿæˆå’ŒéªŒè¯

**Phase 4: è´¨é‡ä¿è¯** (å¤ç”¨ vibecli æµ‹è¯•)
- å®Œæ•´æµ‹è¯•è¦†ç›–
- æ€§èƒ½ä¼˜åŒ–
- é”™è¯¯å¤„ç†å®Œå–„

### 8.5 ä¸ vibecli çš„å…³ç³»ç®¡ç†

- **ä»£ç çº§å¤ç”¨**: å¤åˆ¶ç²˜è´´å¹¶é€‚é… vibecli ä¸­å·²éªŒè¯çš„æ ¸å¿ƒé€»è¾‘
- **ç±»å‹å…±äº«**: å¼•ç”¨æˆ–å¤åˆ¶ vibecli çš„ç±»å‹å®šä¹‰ï¼Œç¡®ä¿æ•°æ®å¥‘çº¦ä¸€è‡´
- **ç‹¬ç«‹éƒ¨ç½²**: è™½ç„¶å¤ç”¨ä»£ç ï¼Œä½†å®Œå…¨ç‹¬ç«‹éƒ¨ç½²ï¼Œé¿å…è¿è¡Œæ—¶ä¾èµ–
- **æŒç»­åŒæ­¥**: å½“ vibecli æœ‰é‡è¦æ”¹è¿›æ—¶ï¼ŒåŒæ­¥æ›´æ–°åˆ° SpecSprite